Sub tietoExcelit()
    ' Check if B40 is empty
    If Range("B40").Value <> "" Then
        Dim folderAddress As String
        Dim infoExcelName As String
        Dim infoExcelPath As String
        
        ' Define the folder address and info excel name based on B40 value
        folderAddress = "Z:\Lähetysohjeet\Asiakirjojen tietoexcelit\"
        infoExcelName = Range("B40").Value & ".xlsx"
        infoExcelPath = folderAddress & infoExcelName
        
        ' Check if the info excel exists
        If Len(Dir(infoExcelPath)) > 0 Then
            ' Open the info excel in the background
            Application.ScreenUpdating = False
            Dim infoExcel As Workbook
            Set infoExcel = Workbooks.Open(infoExcelPath)
            
            ' Retrieve the bank number from "Yleinen" tab
            Dim bankNumberCell As Range
            Set bankNumberCell = infoExcel.Sheets("Yleinen").Columns("A:A").Find("Konttorin numero")
            
            If Not bankNumberCell Is Nothing Then
                Dim bankNumber As String
                bankNumber = infoExcel.Sheets("Yleinen").Cells(bankNumberCell.Row, bankNumberCell.Column + 1).Value
                
                ' Copy the bank name to specified cells in "Main" sheet
                ThisWorkbook.Sheets("Main").Range("D18").Value = bankNumber
                ThisWorkbook.Sheets("Main").Range("B146").Value = bankNumber
                ThisWorkbook.Sheets("Main").Range("C146").Value = bankNumber
                
                ' Retrieve loan numbers from column B
                Dim loanRange As Range
                Dim loanCell As Range
                Dim copiedLoanCount As Integer
                Dim destRange As Range
                
                ' Set the loan range to be scraped
                Set loanRange = infoExcel.Sheets("Yleinen").Columns("B:B")
                
                ' Initialize copied loan count
                copiedLoanCount = 0
                
                ' Loop through each cell in the loan range
                For Each loanCell In loanRange
                    ' Check if the cell value starts with the bank number and "-"
                    If Left(loanCell.Value, Len(bankNumber)) = bankNumber And Mid(loanCell.Value, Len(bankNumber) + 1, 1) = "-" Then
                        copiedLoanCount = copiedLoanCount + 1
                        
                        ' Copy the loan number to the specified range in "Main" sheet
                        If copiedLoanCount <= 4 Then
                            ' Determine the destination range for loan numbers
                            Set destRange = ThisWorkbook.Sheets("Main").Range("B53").Offset(copiedLoanCount - 1, 0)
                            
                            ' Copy the loan number to the destination range
                            destRange.Value = loanCell.Value
                        End If
                    End If
                Next loanCell
                
                ' Close the info excel without saving changes
                infoExcel.Close False
                
                ' Reset screen updating
                Application.ScreenUpdating = True
                
                ' Show message indicating successful import
                MsgBox "Tiedot tuotu onnistuneesti."
                
                ' Check the number of loan numbers found
                If copiedLoanCount > 4 Then
                    MsgBox "Enemmän kuin neljä lainaa lödetty. Tarkista tuodut tiedot lainoista."
                End If
            Else
                ' Close the info excel without saving changes
                infoExcel.Close False
                
                ' Reset screen updating
                Application.ScreenUpdating = True
                
                ' Show error message to the user
                MsgBox "Tietoja ei onnistuttu tuomaan. Tarkista 'Konttorin numero' solun sijainti."
            End If
        Else
            ' Show error message to the user
            MsgBox "Tietoja ei onnistuttu tuomaan. Tarkista hankenumero solusta B40."
        End If
    End If
End Sub
