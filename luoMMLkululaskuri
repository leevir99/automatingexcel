Sub CopyExcelFile()
    ' Define the SharePoint URL and folder address
    Dim sharePointURL As String
    Dim folderAddress As String
    Dim newFileName As String
    
    sharePointURL = "https://oppalveluto365.sharepoint.com/sites/srv00076/Jaetut%20asiakirjat/MML-kululaskuri.xlsm"
    folderAddress = Range("E28").Value
    
    ' Check if the folder address is provided
    If folderAddress = "" Then
        MsgBox "Folder address is missing. Please enter the folder address in cell E28.", vbCritical
        Exit Sub
    End If
    
    ' Create a new Excel application instance
    Dim xlApp As Object
    Set xlApp = CreateObject("Excel.Application")
    
    ' Disable alerts and screen updating for better performance
    xlApp.DisplayAlerts = False
    xlApp.ScreenUpdating = False
    
    ' Open the source file from SharePoint in read-only mode
    Dim sourceWorkbook As Object
    Set sourceWorkbook = xlApp.Workbooks.Open(sharePointURL, ReadOnly:=True)
    
    ' Generate a unique filename for the copy
    newFileName = "Copy_" & Format(Now(), "YYYYMMDD_HHMMSS") & ".xlsm"
    
    ' Save the copy to the specified folder
    Dim destinationWorkbook As Object
    Set destinationWorkbook = sourceWorkbook.SaveAs(folderAddress & "\" & newFileName)
    
    ' Close the destination workbook and the source workbook
    destinationWorkbook.Close False
    sourceWorkbook.Close False
    
    ' Quit the Excel application
    xlApp.Quit
    
    ' Release the object references
    Set destinationWorkbook = Nothing
    Set sourceWorkbook = Nothing
    Set xlApp = Nothing
    
    ' Enable alerts and screen updating
    Application.DisplayAlerts = True
    Application.ScreenUpdating = True
    
    MsgBox "File has been copied successfully!", vbInformation
End Sub
