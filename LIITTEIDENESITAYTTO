Sub liitteidenEsitayttoFill()
    Dim wb As Workbook
    Dim wsMain As Worksheet
    Dim wsLiitteet As Worksheet
    Dim resetLiitteet As Variant
   
    On Error Resume Next
    Set wb = Workbooks("Hankkeet makroilla2.xls")
    On Error GoTo 0
   
    If wb Is Nothing Then
        Set wb = Workbooks.Open("C:\Users\B730706\OneDrive - OP\Työpöytä\Luojan työkalut\Hankkeet makroilla2.xls")
        Do Until wb.ReadOnly = False
            DoEvents
        Loop
    End If
   
    On Error Resume Next
    Set wsMain = wb.Sheets("Main")
    On Error GoTo 0
   
    If wsMain Is Nothing Then
        MsgBox "Main välilehti ei ole aktiivinen"
        Exit Sub
    End If
   
    Set wsLiitteet = wb.Sheets("LUO LIITTEET")
   
    If resetLiitteet Then
        wb.Application.Run "'Copy of Liitteiden esitäyttöBAW.xlsm'!tyhjennä"
    End If
    
    ' Call the new function to fill the cells based on the conditions
    identifioiTakaisinmaksuturva wsLiitteet, wsMain
   
    wsLiitteet.Range("D7").Value = wsMain.Range("B40").Value
    wsLiitteet.Range("B11:B13").Value = "X"
    wsLiitteet.Range("B15").Value = "X"
End Sub

Sub identifioiTakaisinmaksuturva(wsLiitteet As Worksheet, wsMain As Worksheet)
    Dim ratkaisuehdotusSheet As Worksheet
    Dim tytyFound As Boolean
    Dim henkiFound As Boolean
    Dim searchString As String
    
    On Error Resume Next
    Set ratkaisuehdotusSheet = wsMain.Parent.Sheets("Ratkaisuehdotus")
    On Error GoTo 0
    
    If ratkaisuehdotusSheet Is Nothing Then
        MsgBox "Worksheet 'Ratkaisuehdotus' not found."
        Exit Sub
    End If
    
    ' Search for "Tyty" and "Henki" substrings in the Ratkaisuehdotus sheet
    searchString = ratkaisuehdotusSheet.Range("A1:Z100").Value ' Modify the range as per your data
    tytyFound = InStr(1, searchString, "Tyty", vbTextCompare) > 0
    henkiFound = InStr(1, searchString, "Henki", vbTextCompare) > 0
    
    ' Check the conditions and fill the cells accordingly
    If tytyFound And henkiFound Then
        wsLiitteet.Range("G16").Value = "X"
        wsLiitteet.Range("G22").Value = "X"
    ElseIf tytyFound Then
        wsLiitteet.Range("G16").Value = "X"
        wsLiitteet.Range("G18").Value = "X"
    ElseIf henkiFound Then
        wsLiitteet.Range("G16").Value = "X"
        wsLiitteet.Range("G20").Value = "X"
    End If
End Sub
