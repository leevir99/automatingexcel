Sub FillFieldsWithModifiedValues()
    Dim excelApp As Object ' Excel.Application
    Dim excelWorkbook As Object ' Excel.Workbook
    Dim excelWorksheet As Object ' Excel.Worksheet
    Dim valueD32 As String
    Dim valueD1 As String
    Dim valueD50 As Double
    Dim valueD60 As Double
    Dim valueD64 As Double
    Dim modifiedValueD32 As String
    Dim modifiedValueD1 As String
    Dim sumValue As Double
    Dim valueG12 As String
    Dim valueG24 As String
    Dim valueG26 As String
    Dim valueG27 As String
    Dim teksti51Value As String
    
    ' Check if an Excel instance is already open
    On Error Resume Next
    Set excelApp = GetObject(, "Excel.Application")
    On Error GoTo 0
    
    ' If no open instance is found, create a new one
    If excelApp Is Nothing Then
        Set excelApp = CreateObject("Excel.Application")
    End If
    
    ' Try opening "MML-kululaskuri.xlsm" workbook
    On Error Resume Next
    Set excelWorkbook = excelApp.Workbooks("MML-kululaskuri.xlsm")
    On Error GoTo 0
    
    ' If "MML-kululaskuri.xlsm" workbook is not found, try opening "Copy of MML-kululaskuri.xlsm"
    If excelWorkbook Is Nothing Then
        Set excelWorkbook = excelApp.Workbooks("Copy of MML-kululaskuri.xlsm")
    End If
    
    ' Check if "MML-kululaskuri.xlsm" or "Copy of MML-kululaskuri.xlsm" workbook is successfully opened
    If Not excelWorkbook Is Nothing Then
        Set excelWorksheet = excelWorkbook.Worksheets(1)
        
        ' Get the value from cell D32 in Excel
        valueD32 = excelWorksheet.Range("D32").Value
        
        ' Trim the value from cell D32 and remove the Euro symbol
        modifiedValueD32 = Trim(Replace(valueD32, "€", ""))
        
        ' Fill the "Teksti45" field in Word with the modified value from D32
        Documents("Toimeksiantosopimus asuntokauppa ja vakuusjärjestelyt.docx").FormFields("Teksti45").Result = modifiedValueD32
        
        ' Get the value from cell D1 in Excel
        valueD1 = excelWorksheet.Range("D1").Value
        
        ' Trim the value from cell D1 and remove the Euro symbol
        modifiedValueD1 = Trim(Replace(valueD1, "€", ""))
        
        ' Fill the "Teksti48" field in Word with the modified value from D1
        Documents("Toimeksiantosopimus asuntokauppa ja vakuusjärjestelyt.docx").FormFields("Teksti48").Result = modifiedValueD1
        
        ' Get the values from cells D50, D60, and D64 in Excel
        valueD50 = excelWorksheet.Range("D50").Value
        valueD60 = excelWorksheet.Range("D60").Value
        valueD64 = excelWorksheet.Range("D64").Value
        
        ' Calculate the sum of the three values
        sumValue = valueD50 + valueD60 + valueD64
        
        ' Fill the "Teksti46" field in Word with the calculated sum
        Documents("Toimeksiantosopimus asuntokauppa ja vakuusjärjestelyt.docx").FormFields("Teksti46").Result = sumValue
        
        ' Get the value from cell G12 in Excel
        valueG12 = excelWorksheet.Range("G12").Value
        
        ' Check if any value in the range G24:G27 is empty
        If excelWorksheet.Range("G24:G27").Find("") Is Nothing Then
            ' If all values are present, concatenate G24, ", osakkeet ", and G26
            valueG24 = excelWorksheet.Range("G24").Value
            valueG26 = excelWorksheet.Range("G26").Value
            teksti51Value = valueG24 & ", osakkeet " & valueG26
        Else
            ' If any value is empty, set the "Teksti51" field in Word to the value of G12
            teksti51Value = valueG12
        End If
        
        ' Fill the "Teksti51" field in Word with the determined value
        Documents("Toimeksiantosopimus asuntokauppa ja vakuusjärjestelyt.docx").FormFields("Teksti51").Result = teksti51Value
    End If
    
    ' Clean up objects
    Set excelWorksheet = Nothing
    Set excelWorkbook = Nothing
    Set excelApp = Nothing
End Sub
