Sub UpdateDataFromPDF()
    Dim pdfText As String
    Dim lines As Variant
    Dim rpSheet As Worksheet
    Dim startCell As Range
    Dim ratkaisuehdotusCell As Range
    Dim hakijatCell As Range
    Dim luototussuhdeRange As Range
    Dim luototussuhdeCell As Range
    Dim luototussuhdeCount As Long
    Dim targetRange As Range
    Dim luototussuhdeValues As Collection
    
    ' Set the worksheet variables
    Set rpSheet = ThisWorkbook.Sheets("rp")
    
    ' Prompt the user to copy the contents of the PDF file
    MsgBox "Please copy the entire text content of the PDF file and click OK when ready."
    
    ' Clear the entire "rp" sheet
    rpSheet.Cells.Clear
    
    ' Retrieve the copied text from the clipboard
    pdfText = GetClipboardText()
    
    ' Split the text into lines
    lines = Split(pdfText, vbCrLf)
    
    ' Specify the starting cell for inserting the PDF text (change A1 to the desired cell reference)
    Set startCell = rpSheet.Range("A1")
    
    ' Insert the PDF text into the "rp" sheet starting from cell A1
    startCell.Resize(UBound(lines) + 1).Value = Application.Transpose(lines)
    
    ' Find the ratkaisuehdotus cell
    Set ratkaisuehdotusCell = rpSheet.Cells.Find("Ratkaisuehdotus", LookIn:=xlValues, LookAt:=xlWhole)
    
    ' Find the hakijat cell
    Set hakijatCell = rpSheet.Cells.Find("Hakijat", LookIn:=xlValues, LookAt:=xlWhole, After:=ratkaisuehdotusCell)
    
    ' Find the luototussuhde values between ratkaisuehdotus and hakijat cells
    If Not ratkaisuehdotusCell Is Nothing And Not hakijatCell Is Nothing Then
        Set luototussuhdeRange = rpSheet.Range(ratkaisuehdotusCell.Offset(1), hakijatCell.Offset(-1))
        Set luototussuhdeCell = luototussuhdeRange.Find("Luototussuhde", LookIn:=xlValues, LookAt:=xlPart)
        
        If Not luototussuhdeCell Is Nothing Then
            Set targetRange = ThisWorkbook.Sheets("Main").Range("B82")
            Set luototussuhdeValues = New Collection
            luototussuhdeCount = 0
            
            Do
                If Not luototussuhdeValues.Contains(luototussuhdeCell.Value) Then
                    luototussuhdeCount = luototussuhdeCount + 1
                    targetRange.Offset(luototussuhdeCount - 1).Value = luototussuhdeCell.Value
                    luototussuhdeValues.Add luototussuhdeCell.Value
                End If
                
                Set luototussuhdeCell = luototussuhdeRange.FindNext(luototussuhdeCell)
                
            Loop While luototussuhdeCount < 4 And Not luototussuhdeCell Is Nothing
            
            If luototussuhdeCount > 2 Then
                MsgBox "HUOM! Luototussuhteita havaittiin enemmän kuin kaksi. Datan syöttö lopetettu. Tarkista solut B82:B85 ja rahoituspäätöksen tiedot lainoista."
            End If
        End If
    End If
End Sub
